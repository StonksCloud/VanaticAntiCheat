package net.vounty.vanatic.detection.detections.exploit;

import io.github.retrooper.packetevents.packetwrappers.NMSPacket;
import io.github.retrooper.packetevents.packetwrappers.WrappedPacket;
import io.github.retrooper.packetevents.packetwrappers.play.in.helditemslot.WrappedPacketInHeldItemSlot;
import net.vounty.vanatic.detection.VanaticDetection;
import net.vounty.vanatic.detection.value.VanaticValue;
import net.vounty.vanatic.user.User;
import net.vounty.vanatic.utils.annotations.DetectionInformation;
import net.vounty.vanatic.utils.enums.*;
import org.bukkit.entity.Player;

@DetectionInformation(
        name = "Exploit",
        type = DetectionType.A,
        category = DetectionCategory.EXPLOIT,
        status = DetectionStatus.GLOBAL,
        banAmount = 3,
        kickAmount = 1
)
public class ExploitA extends VanaticDetection {

    @Override
    public Boolean onPacket(User user, NMSPacket nmsPacket, WrappedPacket wrappedPacket, ProtocolMode mode, ProtocolType type) {

        if (!(mode.equals(ProtocolMode.RECEIVE) &&
              type.equals(ProtocolType.PLAY)))
            return false;

        if (wrappedPacket instanceof WrappedPacketInHeldItemSlot) {
            final WrappedPacketInHeldItemSlot packet = new WrappedPacketInHeldItemSlot(nmsPacket);
            final Player player = user.getPlayer();
            final int slot = packet.getCurrentSelectedSlot();

            this.debug(player, VanaticValue.of("Slot", slot));

            if (slot > 9 || slot < 0) {
                this.flagPlayer(player, VanaticValue.of("Slot", slot));
                return true;
            }
        }

        return false;
    }

}
